name: semaphore
base: core18
version: 2.7.1
summary: Modern UI for Ansible
description: |
  Ansible Semaphore is beautiful web interface for running Ansible playbooks.
  If your project has grown and deploying from the terminal is no longer for you then Ansible Semaphore is what you need.

grade: devel
confinement: classic

apps:
  semaphored:
    command: semaphored
    daemon: simple
    plugs:
      - network-bind

  semaphore:
    command: semaphore
    plugs:
      - network-bind
      - network

parts:
  semaphore:
    plugin: nil
    source: https://github.com/ansible-semaphore/semaphore/archive/refs/tags/v2.7.1.tar.gz
    source-type: tar
    build-packages:
      - curl
      - gcc 
      - g++ 
      - make
    build-snaps:
      - go
    override-build: |
      curl -sL https://deb.nodesource.com/setup_14.x -o nodesource_setup.sh
      bash nodesource_setup.sh
      apt install nodejs -y
      export GOPATH=/root/go
      export GOBIN=$GOPATH/bin
      export PATH=$PATH:$GOBIN
      go install github.com/go-task/task/v3/cmd/task@latest
      task deps
      task compile
      task build:local
      cp bin/semaphore $SNAPCRAFT_PART_INSTALL/semaphore
      

  semaphored:
    plugin: nil
    source: ./bin
    source-type: local
    override-build: |
      chmod +x semaphored
      cp semaphored $SNAPCRAFT_PART_INSTALL/semaphored